import os, sys
#import timeit
import datetime

path = os.path.split(os.getcwd())[0]
sys.path.append(path)

from controller import *


desc = "HF_EXAMPLE"
filename = "hf_test.xml"

controllerObj = Project()

controllerObj.setup(id = '191', name='test01', description=desc)


#-----------------------PATH------------------------------#
folder="d2015119"
#doitnow = datetime.datetime.now()
doitnow = datetime.datetime.now() - datetime.timedelta(days=1)
y = doitnow.year
m = doitnow.month
d = int(doitnow.day)
#d = d-1
#if d<10:
#   d="0"+str(d)

date = str(y)+"/"+str(m)+"/"+str(d)

path='/home/hfuser/HFA/DATA/hfdata_2016/procdata'
#path='/home/hfuser/HFB/DATA/hfdata_2016/procdata'


savepath='/DATA/HFADATA/hfdata_2016/pdata/sp1_f0'
#savepath='/DATA/HFBDATA/hfdata_2016/pdata/sp1_f0'

#---------------------------------------------------------#
readUnitConfObj = controllerObj.addReadUnit(datatype='HFReader',
                                            path=path,
                                            frequency=2.72,
                                            startDate = date,
                                            endDate = date,
                                            startTime='00:00:00',
                                            endTime='23:59:59',
                                            online=0,
                                            #delay=20,
                                            walk=1,
                                            timezone=-5*3600)


procUnitConfObj0 = controllerObj.addProcUnit(datatype='VoltageProc', inputId=readUnitConfObj.getId())

# opObj12 = procUnitConfObj0.addOperation(name='selectChannels',optype='self')
# opObj12.addParameter(name='channelList', value='0', format='intList')

opObj12 = procUnitConfObj0.addOperation(name='setRadarFrequency')
opObj12.addParameter(name='frequency', value='2.72e6', format='float')

#opObj12 = procUnitConfObj0.addOperation(name='CohInt', optype='other')
#opObj12.addParameter(name='n', value='4', format='int')
    
# opObj11 = procUnitConfObj0.addOperation(name='Scope', optype='other')
# opObj11.addParameter(name='id', value='10', format='int')
# opObj11.addParameter(name='wintitle', value='Voltage', format='str')
# opObj11.addParameter(name='ymin', value='-1e-8', format='float')
# opObj11.addParameter(name='ymax', value='1e-8', format='float')
# # 
procUnitConfObj1 = controllerObj.addProcUnit(datatype='SpectraProc', inputId=procUnitConfObj0.getId())
procUnitConfObj1.addParameter(name='nFFTPoints', value='100', format='int')
procUnitConfObj1.addParameter(name='nProfiles', value='100', format='int')
#procUnitConfObj1.addParameter(name='pairsList', value='(0,1)', format='pairsList')
procUnitConfObj1.addParameter(name='pairsList', value='(0,1),(2,3),(4,5)', format='pairsList')

opObj11 = procUnitConfObj1.addOperation(name='IncohInt', optype='other')
opObj11.addParameter(name='n', value='6', format='float')

opObj11 = procUnitConfObj1.addOperation(name='SpectraWriter', optype='other')
opObj11.addParameter(name='path', value=savepath)
opObj11.addParameter(name='blocksPerFile', value='2', format='int')

print "Escribiendo el archivo XML"
controllerObj.writeXml(filename)
print "Leyendo el archivo XML"
controllerObj.readXml(filename)

controllerObj.createObjects()
controllerObj.connectObjects()

#timeit.timeit('controllerObj.run()', number=2)

controllerObj.run()