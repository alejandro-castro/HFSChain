import os, sys
#import timeit
import datetime

path = os.path.split(os.getcwd())[0]
sys.path.append(path)

from controller import *

desc = "HF_EXAMPLE"
filename = "hf_test.xml"

controllerObj = Project()

controllerObj.setup(id = '191', name='test01', description=desc)


#-----------------------------PATH-PDATA--------------------------------------#
folder='d2015194'
#path='/datar_sdc/DATA/hfradar_2015/pdata/sp1_f1/'+folder
path='/datar_sdc/DATA/hfdata_2016/pdata/sp1_f1/'
print path
#path='/home/alex/Desktop/d2015070/pdata/sp1_f0'
#-----------------------------------------------------------------------------#


#-----------------------------PATH-graficos-----------------------------------#
#folder='d2015160'
#figpath='/datar_sdc/DATA/hfradar_2015/graphics_schain/sp1_f0/'+folder
figpath='/datar_sdc/DATA/hfdata_2016/graphics_schain/sp1_f1'
number='3640'
#figpath='/home/alex/Desktop/d2015070/graficos/sp1_f0'
#------------------------------------------------------------------------------#
#-----------------------------ftp-graficos-wmaster-------AnO-MES-DIA----------#
fecha="2015/06/12"
ftpfolder='/home/wmaster/web2/web_signalchain/data/JRO/HF/'+fecha+'/figures/'
#-----------------------------------------------------------------------------#


readUnitConfObj = controllerObj.addReadUnit(datatype='SpectraReader',
                                            path=path,
                                            startDate='2015/06/18',
                                            endDate='2015/06/30',
                                            startTime='00:00:00',
                                            endTime='23:59:59',
                                            online=1,
                                            set=0,
                                            delay=120,
                                            walk=1
                                            )

procUnitConfObj1 = controllerObj.addProcUnit(datatype='SpectraProc', inputId=readUnitConfObj.getId())
opObj12 = procUnitConfObj1.addOperation(name='removeInterference')

# opObj11 = procUnitConfObj1.addOperation(name='SpectraPlot', optype='other')
# opObj11.addParameter(name='id', value='1000', format='int')
# opObj11.addParameter(name='wintitle', value='HF_Jicamarca_Spc', format='str')
# #opObj11.addParameter(name='channelList', value='0', format='intlist') 
# opObj11.addParameter(name='zmin', value='-120', format='float')
# opObj11.addParameter(name='zmax', value='-70', format='float')
# opObj11.addParameter(name='save', value='1', format='int')
# opObj11.addParameter(name='figpath', value=figpath, format='str')
# # opObj11.addParameter(name='figfile', value=figfile_spectra_name, format='str')
# # opObj11.addParameter(name='wr_period', value='5', format='int')
# #opObj11.addParameter(name='ftp_wei', value='0', format='int')
# #opObj11.addParameter(name='exp_code', value='20', format='int')
# #opObj11.addParameter(name='sub_exp_code', value='0', format='int')
# #opObj11.addParameter(name='plot_pos', value='0', format='int')


opObj11 = procUnitConfObj1.addOperation(name='RTIPlot', optype='other')
opObj11.addParameter(name='id', value='2000', format='int')
opObj11.addParameter(name='wintitle', value='HF_Jicamarca', format='str')
opObj11.addParameter(name='showprofile', value='0', format='int')
#opObj11.addParameter(name='channelList', value='0', format='intlist') 
opObj11.addParameter(name='xmin', value='0', format='float')
opObj11.addParameter(name='xmax', value='24', format='float')
opObj11.addParameter(name='zmin', value='-110', format='float')
opObj11.addParameter(name='zmax', value='-70', format='float')
opObj11.addParameter(name='save', value='1', format='int')
opObj11.addParameter(name='figpath', value=figpath, format='str')
opObj11.addParameter(name='ftp',value='1',format='bool')
opObj11.addParameter(name='data_time_save',value='1',format='bool')
#opObj11.addParameter(name='figfile', value=figfile_power_name, format='str')
opObj11.addParameter(name='wr_period', value='10', format='int')
opObj11.addParameter(name='ftp_wei', value='1', format='int')
opObj11.addParameter(name='exp_code', value='111', format='int')
opObj11.addParameter(name='sub_exp_code', value=number, format='int')
opObj11.addParameter(name='plot_pos', value='1', format='int')


opObj11 = procUnitConfObj1.addOperation(name='CoherenceMap', optype='other')
opObj11.addParameter(name='id', value='3000', format='int')
opObj11.addParameter(name='wintitle', value='HF_Jicamarca', format='str')
opObj11.addParameter(name='showprofile', value='0', format='int')

opObj11.addParameter(name='COH', value='0', format='bool')
opObj11.addParameter(name='PHASE', value='1', format='bool')
opObj11.addParameter(name='xmin', value='0', format='float')
opObj11.addParameter(name='xmax', value='24', format='float')
#opObj11.addParameter(name='channelList', value='0', format='intlist') 
opObj11.addParameter(name='save', value='1', format='bool')
opObj11.addParameter(name='figpath', value=figpath, format='str')
opObj11.addParameter(name='data_time_save',value='1',format='bool')
opObj11.addParameter(name='wr_period', value='10', format='int')
opObj11.addParameter(name='ftp_wei', value='11', format='int')
opObj11.addParameter(name='exp_code', value='888', format='int')
opObj11.addParameter(name='sub_exp_code', value=number, format='int')
opObj11.addParameter(name='plot_pos', value='1', format='int')
opObj11.addParameter(name='ext', value='.jpeg', format='str')


 
opObj11 = procUnitConfObj1.addOperation(name='CoherenceMap', optype='other')
opObj11.addParameter(name='id', value='3002', format='int')
opObj11.addParameter(name='wintitle', value='HF_Jicamarca', format='str')
opObj11.addParameter(name='showprofile', value='0', format='int')
opObj11.addParameter(name='COH', value='1', format='bool')
opObj11.addParameter(name='PHASE', value='0', format='bool')
opObj11.addParameter(name='xmin', value='0', format='float')
opObj11.addParameter(name='xmax', value='24', format='float')
#opObj11.addParameter(name='channelList', value='0', format='intlist') 
opObj11.addParameter(name='save', value='1', format='bool')
opObj11.addParameter(name='figpath', value=figpath, format='str')
opObj11.addParameter(name='data_time_save',value='1',format='bool')
opObj11.addParameter(name='wr_period', value='10', format='int')
opObj11.addParameter(name='ftp_wei', value='11', format='int')
opObj11.addParameter(name='exp_code', value='999', format='int')
opObj11.addParameter(name='sub_exp_code', value=number, format='int')
opObj11.addParameter(name='plot_pos', value='1', format='int')
opObj11.addParameter(name='ext', value='.jpeg', format='str')

 
   
procUnitConfObj2 = controllerObj.addProcUnit(datatype='ParametersProc', inputId=procUnitConfObj1.getId())
opObj20 = procUnitConfObj2.addOperation(name='GetMoments')

opObj21 = procUnitConfObj2.addOperation(name='ParametersPlot', optype='other')
opObj21.addParameter(name='id', value='4000', format='int')
opObj21.addParameter(name='wintitle', value='Doppler-Radial Velocity Plot0', format='str')
opObj21.addParameter(name='channelList', value='0', format='intlist') 
opObj21.addParameter(name='SNR', value='0', format='bool')
opObj21.addParameter(name='SNRmin', value='-10', format='int')
opObj21.addParameter(name='SNRmax', value='30', format='int')
opObj21.addParameter(name='SNRthresh', value='0', format='float')
opObj21.addParameter(name='xmin', value=0, format='float')
opObj21.addParameter(name='xmax', value=24, format='float')
#opObj21.addParameter(name='parameterIndex', value=, format='int')
opObj21.addParameter(name='save', value='1', format='bool')
opObj21.addParameter(name='figpath', value=figpath, format='str')
opObj21.addParameter(name='data_time_save',value='1',format='bool')
opObj21.addParameter(name='wr_period', value='10', format='int')
opObj21.addParameter(name='ftp_wei', value='11', format='int')
opObj21.addParameter(name='exp_code', value='777', format='int')
opObj21.addParameter(name='sub_exp_code', value=number, format='int')
opObj21.addParameter(name='plot_pos', value='1', format='int')
opObj21.addParameter(name='ext', value='.jpeg', format='str')
    
#   
#opObj23 = procUnitConfObj2.addOperation(name='ParametersPlot', optype='other')
#opObj23.addParameter(name='id', value='5000', format='int')
#opObj23.addParameter(name='wintitle', value='Doppler-Radial Velocity Plot1', format='str')
#opObj23.addParameter(name='channelList', value='1', format='intlist') 
#opObj23.addParameter(name='save', value='1', format='bool')
#opObj23.addParameter(name='figpath', value=figpath, format='str')
#opObj23.addParameter(name='SNR', value='0', format='bool')
#opObj23.addParameter(name='SNRmin', value='-20', format='int')
#opObj23.addParameter(name='SNRmax', value='50', format='int')
#opObj23.addParameter(name='SNRthresh', value='0', format='float')
#opObj23.addParameter(name='xmin', value=0, format='float')
#opObj23.addParameter(name='xmax', value=24, format='float')
#opObj23.addParameter(name='wr_period', value='5', format='int')
#opObj23.addParameter(name='ftp_wei', value='11', format='int')
#opObj23.addParameter(name='exp_code', value='444', format='int')
#opObj23.addParameter(name='sub_exp_code', value=number, format='int')
#opObj23.addParameter(name='plot_pos', value='1', format='int')
#ssopObj23.addParameter(name='ext', value='.jpeg', format='str')
   
   
opObj21 = procUnitConfObj2.addOperation(name='ParametersPlot', optype='other')
opObj21.addParameter(name='id', value='7000', format='int')
opObj21.addParameter(name='wintitle', value='SNR_0', format='str')
opObj21.addParameter(name='channelList', value='0', format='intlist') 
opObj21.addParameter(name='SNR', value='1', format='bool')
opObj21.addParameter(name='DOP', value='0', format='bool')
opObj21.addParameter(name='SNRmin', value='-10', format='int')
opObj21.addParameter(name='SNRmax', value='30', format='int')
opObj21.addParameter(name='SNRthresh', value='0', format='float')
opObj21.addParameter(name='xmin', value=0, format='float')
opObj21.addParameter(name='xmax', value=24, format='float')
#opObj21.addParameter(name='parameterIndex', value=, format='int')
opObj21.addParameter(name='save', value='1', format='bool')
opObj21.addParameter(name='figpath', value=figpath, format='str')
opObj21.addParameter(name='data_time_save',value='1',format='bool')
opObj21.addParameter(name='wr_period', value='10', format='int')
opObj21.addParameter(name='ftp_wei', value='11', format='int')
opObj21.addParameter(name='exp_code', value='555', format='int')
opObj21.addParameter(name='sub_exp_code', value=number, format='int')
opObj21.addParameter(name='plot_pos', value='1', format='int')   
opObj21.addParameter(name='ext', value='.jpeg', format='str')




opObj21 = procUnitConfObj2.addOperation(name='ParametersPlot', optype='other')
opObj21.addParameter(name='id', value='8000', format='int')
opObj21.addParameter(name='wintitle', value='SNR_1', format='str')
opObj21.addParameter(name='channelList', value='1', format='intlist') 
opObj21.addParameter(name='SNR', value='1', format='bool')
opObj21.addParameter(name='DOP', value='0', format='bool')
opObj21.addParameter(name='SNRmin', value='-10', format='int')
opObj21.addParameter(name='SNRmax', value='30', format='int')
opObj21.addParameter(name='SNRthresh', value='0', format='float')
opObj21.addParameter(name='xmin', value=0, format='float')
opObj21.addParameter(name='xmax', value=24, format='float')
#opObj21.addParameter(name='parameterIndex', value=, format='int')
opObj21.addParameter(name='save', value='1', format='bool')
opObj21.addParameter(name='figpath', value=figpath, format='str')
opObj21.addParameter(name='data_time_save',value='1',format='bool')
opObj21.addParameter(name='wr_period', value='10', format='int')
opObj21.addParameter(name='ftp_wei', value='11', format='int')
opObj21.addParameter(name='exp_code', value='666', format='int')
opObj21.addParameter(name='sub_exp_code', value=number, format='int')
opObj21.addParameter(name='plot_pos', value='1', format='int')
opObj21.addParameter(name='ext', value='.jpeg', format='str')
   

#opObj11 = procUnitConfObj1.addOperation(name='SendByFTP', optype='other')
#opObj11.addParameter(name='ext', value='*.jpeg', format='str')
#opObj11.addParameter(name='localfolder', value=figpath, format='str')
#opObj11.addParameter(name='remotefolder', value=ftpfolder, format='str')
#opObj11.addParameter(name='server', value='181.177.232.125', format='str')
#opObj11.addParameter(name='username', value='wmaster', format='str')
#opObj11.addParameter(name='password', value='mst2010vhf', format='str')

print "Escribiendo el archivo XML"
controllerObj.writeXml(filename)
print "Leyendo el archivo XML"
controllerObj.readXml(filename)

controllerObj.createObjects()
controllerObj.connectObjects()

#timeit.timeit('controllerObj.run()', number=2)

controllerObj.run()